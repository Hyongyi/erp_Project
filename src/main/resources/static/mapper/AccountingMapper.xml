<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.choongang.erpproject.accounting.mapper.AccMapper">

    <sql id="accInsertColumns">
        stat_num
        , stat_date
        , exp_num
        , emp_id
    </sql>

    <sql id="accReturnColumns">
        stat_num
        , stat_date
        , com_acc
        , emp_id
        , emp_name
        , exp_num
        , appl_date
        , appr_date
        , appr
        , expense
        , income
    </sql>

    <insert id="insertAccInfo" parameterType="AccRequestDto">
        Insert INTO acv (<include refid="accInsertColumns"/>)
        VALUES (
                #{stat_num}
                , NOW()
                , #{exp_num}
                , #{emp_id}
        )

    </insert>

    <select id="selectAccList" resultType="AccResponseDto">
        SELECT stat_num
             , com_acc
             , stat_date
             , expense
             , income
        FROM acv
        LEFT JOIN expreport
        ON acv.exp_num = expreport.exp_num
    </select>

    <select id="selectAccDetail" parameterType="long" resultType="AccResponseDto">
        SELECT emp_name
             , appr
             , appr_date
             , com_acc
             , expense
        FROM acv
        INNER JOIN expreport
        ON acv.exp_num = expreport.exp_num
        INNER JOIN emp_table
        ON acv.emp_id = emp_table.emp_id
        WHERE stat_num = #{stat_num};
    </select>

    <select id="getExp_num" parameterType="long" resultType="AccResponseDto">
        SELECT exp_num
        FROM acv
        WHERE stat_num = #{stat_num}
    </select>

</mapper>
